
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Scott Williams</title>
	<meta name="author" content="Scott Williams">

	
	<meta name="description" content="Race Report — Phoenix Rock &#8216;N Roll Half Marathon Jan 28th, 2017 I tend to function better when I have specific goals. As part of improving my &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Scott Williams" type="application/atom+xml">
	
	<link rel="canonical" href="http://blog.swilliams.me/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bigfoot-default.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script type="text/javascript" src="/javascripts/bigfoot.min.js"></script>
<script type="text/javascript" src="//use.typekit.net/non4byl.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript">
    $.bigfoot();
</script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-57339923-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/c314e8a5296aeb512e30f0a11e357f7b?s=100" alt="Profile Picture" style="width: 100px;" />
	
</div>
<hgroup>
  <h1><a href="/">Scott Williams</a></h1>
  
    <h2>Code. Photos. Writing.</h2>
  
</hgroup>

<nav id="marketing">
    <p class="podcasts sidebar-stuff">I also make a podcast. Listen!</p>
    <ul class="podcasts sidebar-stuff">
      <li>
      <a href="https://itunes" class="app-icon"><img src="/images/assets/f2b-art-icon.png" /></a>
      <a href="http://fronttoback.co">Front to Back</a> &mdash; A show about fathers raising daughters
      </li>
    </ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
			<a class="twitter" href="http://twitter.com/swilliams" title="Twitter"></a>
		
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS"></a>
		
	</div>
</nav>
<nav id="main-nav"><ul class="main-navigation">
</ul>

</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2017/01/28/race-report-phoenix-rock-n-roll-half-marathon%1B/" itemprop="url">Race Report — Phoenix Rock &#8216;N Roll Half Marathon</a></h1>
    <div class="date">








  


<time datetime="2017-01-28T15:40:57-07:00" data-updated="true" itemprop="datePublished">Jan 28<span>th</span>, 2017</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>I tend to function better when I have specific goals. As part of improving my overall health I started to take up running back in mid 2015, and got a little more serious in the early parts of 2016. In a fit of pique I decided to sign up to run the 2017 Rock and Roll Marathon in Phoenix. I&rsquo;d never come close to running 13 miles before, so the prospect scared me a little bit.</p>

<p><strong>Training</strong></p>

<p>So, I started to actually train, even though it was months and months away. I stumbled upon Hal Higdon&rsquo;s training programs, liked what I saw and started to do a mix of the <a href="http://www.halhigdon.com/training/51131/Half-Marathon-Novice-1-Training-Program">Novice 1</a> and <a href="http://www.halhigdon.com/training/51312/Half-Marathon-Novice-2-Training-Program">2</a> programs.</p>

<p>I was averaging about 15 miles per week running before summer hit. Then temperatures were averaging mid 90&rsquo;s even at 5am. It wasn&rsquo;t even a particularly dry heat this go around with the occasional 50% humidity. My mileage tapered off to below 10 per week, but the race was in January, so I knew I could pick it back up again.</p>

<p>As fall wore on temperatures finally dipped back down below furnace levels and I started going on longer runs. I was ahead of the training schedule and decided to give the full 13.1 miles a shot on December 17, and got a time of 2:18:19. Not bad. I originally had goals of running it under 2 hours, but I realized that I was just not that fast, and was ok with it.</p>

<p>One other big training run was on the <a href="https://hikearizona.com/decoder.php?ZTN=737">Charles M. Christiansen trail</a>, a 10.7 hiking trail with some relatively steep spots. A couple spots on the trail weren&rsquo;t very well marked, so it ended up being 11.5 miles&hellip; I don&rsquo;t do a ton of trail running, so that was a fun little experience.</p>

<p><strong>The Race</strong></p>

<p>Eventually January 15, 2017 rolled around. The morning of, I wasn&rsquo;t sure what to have for breakfast. I usually eat some mix of breakfast sausage and eggs for protein, but it didn&rsquo;t feel like the right choice to have that grease rolling around in my stomach. I ended up going to my <a href="http://www.chompies.com/bakery-and-bagels">favorite bagel shop</a> and getting a bagel, cream cheese, and lox. It was delicious.</p>

<p>In Tempe, I found some parking<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, stood in line for 20 minutes to use the bathroom, and made it to my corral as the first starters got going. When I registered, I&rsquo;d estimated my finishing time to be 2:20, which placed me right in the middle of the pack.</p>

<p>Eventually we were off! I knew pacing was important and tried to keep a stable one despite the nerves and all the people. I found myself passing a lot of other racers at the start. I checked my watch a few times and my heart rate was fine, so I kept it up.</p>

<p>My goal going in was to be a little faster than my December run. I was aiming for 2:15. A few miles in I saw a the 2:15 pacer. She was easy to spot because she was holding a tall sign with &ldquo;2:15&rdquo; on it. My pace put me ahead of her and I found myself passing more people.</p>

<p>I was feeling good and enjoying the weather. Rain had been predicted, but never materialized, for which I was grateful. Temperature was about 50 degrees with 70% humidity. I was sweating a bit, but not too badly. I started to keep an eye open for the 2:10 pacer.</p>

<p>I kept up my pace and was still passing people and eventually hit the halfway mark. I had been listening to a podcast and decided to switch it over to my running playlist. <a href="https://raceroster.com/events/2017/10542/the-wicked-marathonhalf-marathon4-mile-and-the-spooky-kids-sprint">Let it Out</a> by Switchfoot kicked in and I felt energized. My pace crept up a bit, but I was still feeling pretty good.</p>

<p>The race had water and/or gatorade stations every mile or so I didn&rsquo;t bring an additional bottle. Grabbing a cup of water while jogging and drinking it is tricky, but I got it to work.</p>

<p>The course also had a number of portapotties on the course, should you need that. I tend to hyrdate a lot and need to pee on long runs. The portapotties all had decently sized lines at the first few miles, and thinned out in the latter ones. Around mile 8 I decided to use one, thinking it was available. But, it was locked and in use. I jogged around a bit not wanting to get cold. It felt like hours were ticking by while I waited. In reality it was probably only 30 seconds, but I grew impatient and got back in the race.</p>

<p>Food is also a factor for my long runs. I usually bring a granola bar with me and eat it piece by piece after 8 miles. It&rsquo;s a good 240 calorie boost after burning 800. I had one in my pocket, but never even reached for it. I&rsquo;ve always believed that bagels have magical powers and this proved it because I wasn&rsquo;t even a bit hungry at all during the whole race.</p>

<p>At mile 9 was The Hill. I&rsquo;d heard about it from people who had run the course in the past and how hard The Hill was. I got to it and saw that a lot of people were slowing down. By a lot.</p>

<p>The Hill was not that steep. Come on people.</p>

<p>Total elevation change on the race is 155ish feet, with this hill making up a big part of it, which is practially nothing. My training on the long trail was significantly harder to run. I kept my pace a cruised up, again passing a lot of people. The &lsquo;fun&rsquo; part of the course is that you turn around just past the top of the hill and go right back down. At the top there was a pretty awesome drum and percussion band going to town. That plus a little downhill were when I started to go faster. I passed quite a few people going down. Had it been longer or steeper I would&rsquo;ve had to slow down, but my quads were doing well and the footing was fine.</p>

<p>I did start to get a little tired in mile 11. I was ready to be done with the race by that point. I think the humidity was sapping me by then. I grabbed a cup of water and downed it and kept moving.</p>

<p>This whole time I never saw the 2:10 pacer. I was a little bummed that I couldn&rsquo;t even see him/her, but assumed they were just around the next corner and I wasn&rsquo;t that far behind.</p>

<p>Mile 12 hit and I was re-energized again. One more mile to go! I checked my watch and it was right around 1:53. Holy crap. Under 2 hours was still out, but I realized I could blow past that goal of 2:15. The 2:10 pacer must&rsquo;ve not been holding a sign or I just missed it. I turned up the juice and ran hard.</p>

<p>The last half mile is over a bridge and I was passing people left and right. I wanted start shouting &ldquo;It&rsquo;s almost over, why aren&rsquo;t you running?&rdquo; but didn&rsquo;t. I got around the last corner and saw my wife, kids, and mother cheering me on, which was great. I jumped on the last timing mat and started to make my way through the mass of finishers. The funny thing about the finishing area was that it was filled with all the sponsors handing out chocolate milk, sports drinks, bananas, etc. If I ate/drank all the stuff there I would&rsquo;ve easily thrown up.</p>

<p>I found out later that that my official time was 2:02:57, which was far faster than I was expecting to run.</p>

<p><strong>After/Next</strong></p>

<p>I wasn&rsquo;t particularly tired or sore after the race. However, the stiffness and soreness did set after sitting in the car for the 30 minute drive home. It wasn&rsquo;t too bad though.</p>

<p>Knowing myself, sometimes when I hit a goal I fall back into bad habits. I don&rsquo;t want that to happen this time. So, <a href="https://raceroster.com/events/2017/10542/the-wicked-marathonhalf-marathon4-mile-and-the-spooky-kids-sprint">I signed up to run a <em>full</em> marathon in October</a>. 26 miles to run seems insane, but I&rsquo;ll be sure to train properly and see how it goes.</p>

<div class="footnotes">
  <ol>
    <li class="footnote" id="fn:1">
  <p>Thousands of people were there so finding parking took some doing.</p>
</li>
  </ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/09/07/google-oauth-ember-hapi/" itemprop="url">Google OAuth, Ember, Hapi</a></h1>
    <div class="date">








  


<time datetime="2016-09-07T08:10:50-07:00" data-updated="true" itemprop="datePublished">Sep 7<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>OAuth is, to borrow a phrase, a bag of hurt. Not just any bag, but the kind that is thrown over your head right before you&rsquo;re thrown into a van and driven down to Tijuana and ransomed for $50,000. I don&rsquo;t like OAuth.</p>

<p>Sometimes, though you need to use it. I&rsquo;m working on an internal tool at <a href="http://tallwave.com">work</a> and want to make sure that only co-workers can use it. I could do the username/password thing, but the world has enough of those. We use Google docs for the office, so everyone has a Google account that could, theoretically, be used to sign in. Thus, OAuth.</p>

<p>The tool itself is a web app that uses <a href="http://emberjs.com/">Ember</a> on the front-end and <a href="http://hapijs.com/">Hapi</a> and <a href="https://www.mongodb.com/">MongoDB</a> as the API and database. It&rsquo;s my first time using Hapi, and I like it quite a bit, seems like a really good tool for API building.</p>

<p>Since this is a completely separate client and server, it adds a bit of a wrinkle to the OAuth dance. There are plenty of &ldquo;Sign in with X&rdquo; libraries out there, but they mostly seem to be written with the intent that the user will only be interacting with that service. In other words, if I was building a Google Docs client app, my life would be easier, but no, I am only authenticating a user&rsquo;s account and then treating that as the key to my own system&hellip; which makes it more manual. It also doesn&rsquo;t help that Google&rsquo;s OAuth documentation is lousy. There are many different ways to authenticate, and <a href="https://github.com/google/google-auth-library-nodejs">multiple</a> <a href="https://github.com/google/google-api-nodejs-client">libraries</a> to support the different ways, and they&rsquo;ve changed over time, so searching for help is difficult.</p>

<p>Here&rsquo;s how it&rsquo;s supposed to work:</p>

<ol>
<li>The client (Ember) &ldquo;signs in with Google&rdquo;. If this is successful it receives an <code>authorizationCode</code>. This code by itself is useless, it just means the user signed in ok.</li>
<li>The server (Hapi) needs to validate this code and turn it into an <code>accessToken</code>.</li>
<li>If <em>that</em> is successful, we can query the Google API (from the server still) for the account information, verify that they are from Tallwave, and then send credentials back down to the client.</li>
<li>The client receives the credentials, stores them locally, and includes them for subsequent API requests.</li>
</ol>


<p>Errors need to be handled at all the steps along the way too.</p>

<p><strong>Step 1 — Client Side</strong></p>

<p><a href="https://github.com/Vestorly/torii">Torii</a> is a pretty good (though a wee bit out of date) library for Ember that handles a good amount of the Google sign in process. Follow its installation instructions and setup the configuration and the proper adapter. Here&rsquo;s my <code>environment.js</code> entry:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/* The following properties are in ENV */</span>
</span><span class='line'><span class="nx">torii</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">sessionServiceName</span><span class="o">:</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">providers</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;google-oauth2&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">redirectUri</span><span class="o">:</span> <span class="nx">signinURL</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">apiKey</span><span class="o">:</span> <span class="nx">googleOAuthAPIKey</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">scope</span><span class="o">:</span> <span class="s1">&#39;profile email&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="https://developers.google.com/+/web/api/rest/oauth#authorization-scopes"><code>scope</code></a> property is important. That allows you to query for the user&rsquo;s account later on. The only other point with Torii worth mentioning is how I sent the authorization code to my API. The <code>open</code> method on the <code>torii-adapters/application.js</code> is called after Google auth finishes, and that is where you create the &ldquo;session&rdquo; for authentication.</p>

<p>By default Ember uses the JSON API for the API layer, and I tend to go with the flow. But in this case, since we&rsquo;re sending a single value to the server and will throw it away immediately after&hellip; Setting up a model seems overkill for that. We can drop down to regular old jQuery for this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// This is in torii-adapters/application.js</span>
</span><span class='line'><span class="nx">open</span><span class="p">(</span><span class="nx">authentication</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Ember</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">authorizationCode</span><span class="o">:</span> <span class="nx">authentication</span><span class="p">.</span><span class="nx">authorizationCode</span> <span class="p">},</span>
</span><span class='line'>      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// this is the authentication URL in your API</span>
</span><span class='line'>      <span class="nx">success</span><span class="o">:</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">),</span> <span class="c1">// forward success/error to the Promise</span>
</span><span class='line'>      <span class="nx">error</span><span class="o">:</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">account</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sessionStore&#39;</span><span class="p">).</span><span class="nx">save</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="nx">currentUser</span><span class="o">:</span> <span class="nx">account</span> <span class="p">};</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Worth pointing out is that we are expecting our API to return some JSON that will be:</p>

<ol>
<li>Stored locally (<code>sessionStore</code> is a <a href="https://guides.emberjs.com/v2.7.0/applications/services/">service</a>, which we&rsquo;ll define later), and will be retrieved later.</li>
<li>Returning the <code>currentUser</code> object will merge it into the underlying session, so that it can be retrieved in routes, components, templates etc. This isn&rsquo;t permanent storage though, if the user refreshes the page, it&rsquo;ll be gone, hence <code>sessionStore</code>.</li>
</ol>


<p><strong>Step 2 — On the Server</strong></p>

<p>This is where the fun begins. If you&rsquo;re playing at home, I used Node 5 and Hapi 13.x.x. First, you&rsquo;ll need to get your credentials from the <a href="https://console.developers.google.com">Google Developer Console</a>. I&rsquo;m not going to walk through those steps, but you&rsquo;ll need an OAuth client ID for a Web Application. Specifically, you&rsquo;ll need the client id, client secret, and redirect URL (yes, even though you won&rsquo;t be redirecting to anything at this point).</p>

<p>Then, install the <code>googleapis</code> dependency.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">googleapis</span> <span class="o">--</span><span class="nx">save</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s build a service that sends Google an <code>authorizationCode</code> and gets an accessToken back. You&rsquo;ll call this service from your route handler.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">Google</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;googleapis&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">OAuth2</span> <span class="o">=</span> <span class="nx">Google</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">OAuth2</span><span class="p">;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">Google</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">(</span><span class="s1">&#39;v2&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// pull these from an ENV variable or something else</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">oauthClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OAuth2</span><span class="p">(</span><span class="nx">CLIENT_ID</span><span class="p">,</span> <span class="nx">CLIENT_SECRET</span><span class="p">,</span> <span class="nx">REDIRECT_URL</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Omitting the REDIRECT_URL will throw an error</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// callback is a function whose signature is (error, tokens)</span>
</span><span class='line'>  <span class="nx">getTokens</span><span class="p">(</span><span class="nx">authorizationCode</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">oauthClient</span><span class="p">.</span><span class="nx">getToken</span><span class="p">(</span><span class="nx">authorizationCode</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tokens</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// the authorization code was bad</span>
</span><span class='line'>        <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="c1">// At this point, we have an access token.</span>
</span><span class='line'>      <span class="nx">oauthClient</span><span class="p">.</span><span class="nx">credentials</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Each Google API method takes a params object, </span>
</span><span class='line'>      <span class="c1">// which is where you provide your auth credentials</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">auth</span><span class="o">:</span> <span class="nx">oauthClient</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Retrieve the user&#39;s account</span>
</span><span class='line'>      <span class="nx">profile</span><span class="p">.</span><span class="nx">userinfo</span><span class="p">.</span><span class="nx">v2</span><span class="p">.</span><span class="nx">me</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// The response object contains all of the account info</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// This is where you validate if the user is allowed or not.</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// If the user is valid, create a new session for them and save it.</span>
</span><span class='line'>        <span class="c1">// It&#39;s up to you where you want to save this session. Could be </span>
</span><span class='line'>        <span class="c1">// a redis cache, http session, whatever your needs are.</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// After that, we&#39;re going to send our session token and user </span>
</span><span class='line'>        <span class="c1">// account back.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="kr">const</span> <span class="nx">sessionJSON</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">token</span><span class="o">:</span> <span class="nx">someSessionToken</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">account</span><span class="o">:</span> <span class="nx">response</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">newSession</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s kind of a mouthful and could definitely stand a good refactoring, but it goes through the steps needed to get some information from Google. You can see more <a href="http://google.github.io/google-api-nodejs-client/12.4.0/index.html">APIs</a> you can call, but the documentation on a lot of them is rather sparse. For example, adding the <code>oauthClient</code> to <code>params</code> is not apparent, but necessary for each call.</p>

<p>We&rsquo;ve now determined if the user should actually have access to what they just signed in to and sent the response back to the client. That&rsquo;s pretty good! Refresh your beverage, take a deep breath and then let&rsquo;s get handle that response and get our client in order to keep moving.</p>

<p><strong>Step 3 — Back on the Client</strong></p>

<p>You might have noticed again that we did not send the session information back in JSON API format either. This was intentional since we aren&rsquo;t going to be storing this in the standard Ember store, and therefore don&rsquo;t need the additional benefit of using something that standardized. You could if you wanted to, but for this occasion, I did not want to set up a model (or in this case model<em>s</em> to support the nested structure).</p>

<p>Back up in our <code>Ember.RSVP.Promise</code> handler there was this line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// In torii-adapters/application.js</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sessionStore&#39;</span><span class="p">).</span><span class="nx">save</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you receive a response, you&rsquo;ll need to store it. You could use Ember Data, but that felt overkill to me; I needed to access the tokens within the response for subsequent API calls, and nothing else. I ended up building an <a href="https://guides.emberjs.com/v2.8.0/applications/services/">Ember service</a> that serialized the content and stored it in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage</a>. You can go your own way too.</p>

<p><strong>Step 4 — Making authenticated requests</strong></p>

<p>We&rsquo;re authorized (or have displayed a fancy error message) and are ready to make actual requests to get actual data. I like to authenticate my API requests by including my authorization token in the <code>Authorization</code> header on requests. Ember allows for this by overriding the <code>headers</code> computed property in your Adapter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// adapters/application.js</span>
</span><span class='line'>  <span class="nx">headers</span><span class="o">:</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sessionStore&#39;</span><span class="p">).</span><span class="nx">fetch</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">account</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="nx">account</span><span class="p">.</span><span class="nx">_id</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{};</span>
</span><span class='line'>  <span class="p">}).</span><span class="kr">volatile</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step 5 — Verify authentication on the server</strong></p>

<p>There are may ways to <a href="http://hapijs.com/tutorials/auth">authenticate requests with Hapi</a>. Hapi calls these &ldquo;Schemes&rdquo;. A Scheme is made up of multiple Strategies but since we only have one, we&rsquo;ll just refer to it as a Scheme.</p>

<p>You define a Scheme as a function that takes a <code>server</code> and some <code>options</code> as arguments and go from there. Here&rsquo;s <code>api-auth.js</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// These are the standard Hapi request/reply arguments</span>
</span><span class='line'>    <span class="nx">authenticate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Get the session token from the HTTP Headers of the request</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">req</span><span class="p">;</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">authorization</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>
</span><span class='line'>      <span class="c1">// Fail quickly if it isn&#39;t present.</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">authorization</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">reply</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">unauthorized</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;Basic&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Pull the credentials from the session store that are </span>
</span><span class='line'>      <span class="c1">// associated with the session token. Fail if it&#39;s not valid.</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tokenIsValid</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">reply</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">unauthorized</span><span class="p">(</span><span class="s1">&#39;Authenication failed&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic&#39;</span><span class="p">),</span> <span class="kc">null</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Authenticated, so send the credentials along the chain in </span>
</span><span class='line'>      <span class="c1">// case they need to be used later.</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">reply</span><span class="p">.</span><span class="k">continue</span><span class="p">({</span> <span class="nx">credentials</span><span class="o">:</span> <span class="nx">credentials</span> <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we&rsquo;ve defined our Scheme, we need to register it with Hapi. Wherever the server is set up add this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Import our Scheme</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">apiScheme</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config/api-scheme&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Auth</span>
</span><span class='line'>  <span class="c1">// Schemes have a name which you define here.</span>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">scheme</span><span class="p">(</span><span class="s1">&#39;auth-scheme&#39;</span><span class="p">,</span> <span class="nx">apiScheme</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Strategies also have a name. This is what you&#39;ll refer </span>
</span><span class='line'>  <span class="c1">// to when setting schemes for routes.</span>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">strategy</span><span class="p">(</span><span class="s1">&#39;basic-strategy&#39;</span><span class="p">,</span> <span class="s1">&#39;auth-scheme&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// You can declare all routes to use a one Strategy by default.</span>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="k">default</span><span class="p">(</span><span class="s1">&#39;basic-strategy&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Routes might go here</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you do use a default auth strategy, you can override that on individual routes in their handler config:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span> <span class="nx">reply</span><span class="p">();</span> <span class="p">},</span>
</span><span class='line'>  <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">auth</span><span class="o">:</span> <span class="s1">&#39;another-strategy&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or use the boolean <code>false</code> to skip auth altogether for a route, such as your session creation API.</p>

<p>And we&rsquo;re done! You now have an authenticated API. There are plenty of other points that could be expanded on, but it&rsquo;s getting a little long in the tooth now.</p>

<p><strong>Wait, why not use Bell?</strong></p>

<p>The Hapi organization maintains a project called <a href="https://github.com/hapijs/bell">Bell</a> that is a &ldquo;Third-party login plugin for hapi&rdquo;, including OAuth services. It&rsquo;s great, but the catch is that since half of our authentication takes place in the browser, we can&rsquo;t quite use it the way it is intended to be used.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/07/25/maine-and-back-again/" itemprop="url">Maine and Back Again</a></h1>
    <div class="date">








  


<time datetime="2016-07-25T08:47:36-07:00" data-updated="true" itemprop="datePublished">Jul 25<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>&ldquo;We&rsquo;re going to Maine.&rdquo;</p>

<p>&ldquo;Oh&hellip; do you have family or friends out there?&rdquo;</p>

<p>That&rsquo;s usually how the conversation went when I informed people of The Williams Family 2016 Vacation plans. It was kind of weird. I mean Maine&rsquo;s not exactly the hotspot for getaways. There are a bunch of more tropical places. Hawaii, Florida, The Caribbean, Idaho. What&rsquo;re you gonna do in Maine? Visit Stephen King?</p>

<p>Well, here&rsquo;s what we did.</p>

<h1>Beach time</h1>

<p>We rented a place for the week in Old Orchard Beach. It was a nice little beach condo about 100 feet from the ocean. You wouldn&rsquo;t normally think of Maine as being a beach destination, but it was better than a lot of quite of few of the beaches in southern California I&rsquo;ve been to. Not too rocky, no giant riptide, water was warm enough (mostly). The waves weren&rsquo;t quite as nice, but fine enough to swim through and throw small children into.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach0-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach0.jpg"></a>
    <figcaption>The path to the beach</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach1-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach1.jpg"></a>
    <figcaption>Partly cloudy</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach2-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach2.jpg"></a>
    <figcaption>The girls getting in the Atlantic</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach3-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach3.jpg"></a>
    <figcaption>Catching waves</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach5-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach5.jpg"></a>
    <figcaption>At night</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach4-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach4.jpg"></a>
    <figcaption>From the pier</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/beach6-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/beach6.jpg"></a>
    <figcaption>Sometimes the moon looks like the sun</figcaption>
</figure>


<h1>Weather</h1>

<p>The temperature was usually in the low 80&rsquo;s during the day. The last day was warm, topping 90, which apparently didn&rsquo;t happen at all last year. Other than that, it was great. It rained a few of the days, but that was a nice change of pace.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/weather1-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/weather1.jpg"></a>
    <figcaption>Storm clouds</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/weather2-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/weather2.jpg"></a>
    <figcaption>Fog. I haven&#8217;t played Silent Hill, but this can&#8217;t be good right?</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/weather3-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/weather3.jpg"></a>
    <figcaption>Temperate</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/weather4-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/weather4.jpg"></a>
    <figcaption>Bliss</figcaption>
</figure>


<h1>Food</h1>

<p>I&rsquo;m on record as loving seafood. If it lives in the ocean I&rsquo;ll probably like eating it, and lots of things swim in the ocean near Maine. We had lobster, lobster rolls, lobster mac &lsquo;n cheese, crab rolls, crab cakes, and shrimp. Most of it was ridiculously cheap. The best places were little dive type places that smelled of delicious fish. I didn&rsquo;t take too many pictures because I&rsquo;m not the biggest fan of taking pictures of food. Perhaps my favorite was a lunch that consisted of two full lobsters, a lobster roll, and a shrimp cocktail. All of that was under $40, which is usually the price for a single lobster at a fancy restaurant out here. Not bad.</p>

<h1>Nature</h1>

<p>Maine&rsquo;s one of the most beautiful places on Earth. The beaches are just a few miles from some amazing forests. I could gush, but I&rsquo;ll let the pictures sell it some more.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature1-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature1.jpg"></a>
    <figcaption>Flowers by the bay</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature2-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature2.jpg"></a>
    <figcaption>House at the end of the lane</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature3-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature3.jpg"></a>
    <figcaption>Gateway</figcaption>
</figure>


<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature4-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature4.jpg"></a>
    <figcaption>Forest</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature5-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature5.jpg"></a>
    <figcaption>Shortcut to Mushrooms</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature6-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature6.jpg"></a>
    <figcaption>Hay</figcaption>
</figure>


<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature7-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature7.jpg"></a>
    <figcaption>Waterfall</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature8-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature8.jpg"></a>
    <figcaption>Forest moon of Endor</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nature9-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nature9.jpg"></a>
</figure>


<h1>And the rest</h1>

<p>Maine also has Lighthouses. This one is called the Portland Head Light.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/lighthouse-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/lighthouse.jpg"></a>
</figure>


<p>There were fireworks on the beach one night.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/fireworks-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/fireworks.jpg"></a>
</figure>


<p>We visited a farm and picked berries. Then ate them.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/berries-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/berries.jpg"></a>
</figure>


<p>We rented kayaks and paddled up the Saco river.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/kayak1-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/kayak1.jpg"></a>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/kayak2-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/kayak2.jpg"></a>
</figure>


<h1>And Finally</h1>

<p>We had an early checkout time on Saturday, but our flight back wasn&rsquo;t until the evening. We took the scenic route through New Hampshire and stopped at Cathedral Ledge for a little hiking and sightseeing. It was a good stop.</p>

<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/nh1-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/nh1.jpg"></a>
    <figcaption>Rock climber (definitely not me)</figcaption>
</figure>




<figure class="center">
    <a href="http://swilliams.me/static/photos/maine/NH-Pano-Color-full.jpg"><img alt="Beach" src="http://swilliams.me/static/photos/maine/NH-Pano-Color.jpg"></a>
    <figcaption>The view</figcaption>
</figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/06/08/apps-i-use-and-if-theyd-work-as-a-subscription/" itemprop="url">Apps I Use and if They&#8217;d Work as a Subscription</a></h1>
    <div class="date">








  


<time datetime="2016-06-08T13:48:04-07:00" data-updated="true" itemprop="datePublished">Jun 8<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>Apps on my home screen that I use most often and my opinion if they&rsquo;d be appropriate for the <a href="https://developer.apple.com/app-store/subscriptions/whats-new/">new subscription service Apple is rolling out</a>.</p>

<ul>
<li><a href="https://geo.itunes.apple.com/us/app/heartwatch.-view-get-notified/id1062745479?mt=8">Heartwatch</a> — probably not</li>
<li><a href="https://geo.itunes.apple.com/us/app/runkeeper-gps-running-walk/id300235330?mt=8">Runkeeper</a> — already has a <a href="https://runkeeper.com/go?utm_campaign=gogeneral&amp;utm_medium=web&amp;pchannel=web.mark.nav&amp;utm_source=homepage">separate subscription service</a></li>
<li><a href="https://geo.itunes.apple.com/us/app/human-activity-tracker-walking/id692721875?mt=8">Human</a> — already has a separate subscription service</li>
<li><a href="https://geo.itunes.apple.com/us/app/addapp-insights/id893111432?mt=8">Addapp Insights</a> — if they beefed their analysis up, maybe</li>
<li><a href="https://geo.itunes.apple.com/us/app/activity++/id1089666978?mt=8">Activity++</a> — no</li>
<li><a href="https://geo.itunes.apple.com/us/app/pedometer++/id712286167?mt=8">Pedometer++</a> — no</li>
<li><a href="https://geo.itunes.apple.com/us/app/fantastical-2-for-ipad-calendar/id830708155?mt=8">Fantastical</a> — no</li>
<li><a href="https://geo.itunes.apple.com/us/app/carrot-weather-talking-forecast/id961390574?mt=8">Carrot Weather</a> — no</li>
<li><a href="https://geo.itunes.apple.com/us/app/simplenote/id289429962?mt=8">Simplenote</a> — had a <a href="https://simplenote.com/premium/">separate subscription service</a>, but it&rsquo;s on hold for now. I bet this news will change that.</li>
<li><a href="https://geo.itunes.apple.com/us/app/unread-rss-news-reader/id911364254?mt=8">Unread</a> — piggyback&rsquo;s onto other subscription services, but doesn&rsquo;t have its own built-in</li>
<li><a href="https://geo.itunes.apple.com/us/app/1password-password-manager/id568903335?mt=8">1Password</a> — already has a <a href="https://1password.com/families/">family</a> or <a href="https://1password.com/teams/">organization</a> plan</li>
<li><a href="https://geo.itunes.apple.com/us/app/spark-love-your-email-again/id997102246?mt=8">Spark</a> — no</li>
<li><a href="https://geo.itunes.apple.com/us/app/calorie-counter-diet-tracker/id341232718?mt=8">MyFitnessPal</a> — already has a <a href="http://blog.myfitnesspal.com/introducing-myfitnesspal-upgrade/">separate subscription service</a></li>
<li><a href="https://geo.itunes.apple.com/us/app/paprika-recipe-manager-for/id406732590?mt=8">Paprika</a> — yes, though they already provide a sync service free of charge (via iCloud perhaps?)</li>
<li><a href="https://geo.itunes.apple.com/us/app/day-one-2-diary-+-journal/id1044867788?mt=8">Day One</a> — yes, though they already provide a sync service free of charge</li>
<li><a href="https://geo.itunes.apple.com/us/app/tweetbot-4-for-twitter/id1018355599?mt=8">Tweetbot</a> — not with the current feature set</li>
<li><a href="https://geo.itunes.apple.com/us/app/overcast-podcast-player/id888422857?mt=8">Overcast</a> — I&rsquo;m betting <a href="https://marco.org/">Marco</a> is already working on integrating the subscription system into Overcast.</li>
</ul>


<p>I wonder how many, if any, will consider switching an existing subscription service to one built into Apple&rsquo;s systems. I wonder how many, if any, companies will <a href="http://mjtsai.com/blog/2016/04/06/textexpander-6-and-textexpander-com/">rush</a> into subscription without really thinking it through and angering all their users. There are a whole lot of economic factors at play to consider before doing that.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/06/07/one-year-of-getting-healthy/" itemprop="url">One Year of Getting Healthy</a></h1>
    <div class="date">








  


<time datetime="2016-06-07T13:10:53-07:00" data-updated="true" itemprop="datePublished">Jun 7<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>I received my Apple Watch just over a year ago. I bought it because it felt like it was going to be the next big platform, and I didn&rsquo;t want to miss out. That didn&rsquo;t turn out to be the case, but what did suck me in were its fitness tracking capabilities. I&rsquo;d been concerned about my overall health and weight since I hit my 30s; my family history that includes such fun things as diabetes and heart disease, and I wanted to avoid those. The watch finally served as the catalyst to really try to do something about it.</p>

<p>A year later, I&rsquo;ve lost 50 pounds. I can run 8 miles without stopping and will be running a half marathon in early 2017. This is how I did that and how I plan to lose a little more, and keep it off. Also note: this worked for me and may not be replicable. People are different and there are so many other factors with regards to health and weight. I don&rsquo;t write this to brag (ok, well maybe just a smidge), or to instruct, but to log.</p>

<p>This was not my first rodeo. A few years ago I was traveling back forth from Phoenix to Dallas for work. Since this was going to last for a few months, so I decided to take advantage of the &ldquo;free&rdquo; time and get serious about working out. I signed up for a gym membership, mapped out a plan with a trainer, and started to lift weights and do the various gym things you do. I also had a per diem for eating expenses from the company and ate far better than I normally would have if left to my own devices<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. It worked pretty well. I went from about 235 down to 195. I had all the intention to keep it off, but then I didn&rsquo;t.</p>

<p>When that project was over I was back at home. I kept up the gym work, but it got harder to fit that in my schedule. In Dallas I didn&rsquo;t have anything else to do but work, go to the gym, and watch bad TV in my hotel room. At home I had a family and friends to, y&#8217;know, do things with. I was back to thinking about my own food again, and the laziness and lack of discipline crept back in. Working in an office with lots of free snacks and soda did not help either.</p>

<p>Eventually the gym attendence faded too. The process of putting on the gym clothes, finding my bag, driving to the gym, doing the locker room thing, then going to lift weights, all on a relatively strict schedule started to be too many hurdles for my lazy butt. I  would go to the gym but then put in a low effort on a treadmill for 20 minutes.  Then I just didn&rsquo;t even go anymore.</p>

<p>Time went on and I found myself fatter than I had been before, somewhere north of 240<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>. It crept up on me and I didn&rsquo;t think I had gotten back to where I was before, and then some.</p>

<p>After some thought I realized that my failure with the Dallas plan wasn&rsquo;t sustainable at home. Everything I had done was based on the notion of being away from home and having the time and money to do all the right things. I needed to come up with a plan that would work with my irregular schedule. I also didn&rsquo;t want to go on a special diet, or any kind of diet really. I&rsquo;ve seen so many people lose weight from dieting and then gain it right back. <a href="http://newsroom.ucla.edu/releases/Dieting-Does-Not-Work-UCLA-Researchers-7832">The evidence supports that notion</a>. I knew that for something permanent to happen, it would have to last me the rest of my life. I came up with three rules to improve my health:</p>

<ol>
<li>Eat a little less</li>
<li>Eat a little better</li>
<li>Exercise a little more</li>
</ol>


<p>And let time and attrition do its thing. I knew this wasn&rsquo;t going to get me any book deals, but it felt like it would work with me.</p>

<h2>Eat a little less &amp; Eat a little better</h2>

<p>I like to eat. No, I <em>really</em> like to eat. I find it to be one of life&rsquo;s pleasures, and you get to do it three times a day!<sup id="fnref:1"><a href="#fn:3" rel="footnote">3</a></sup> I could never be a vegetarian, despite any health risks because I love to eat cows and pigs. <a href="http://thepaleodiet.com/what-to-eat-on-the-paleo-diet/">Paleo</a> won&rsquo;t work for me because I have a torrid love affair with sandwiches.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Meat might cause a slightly elevated risk of cancer? Well that’s a factor to be weighed, but have you tasted brisket?</p>&mdash; Scott Williams (@swilliams) <a href="https://twitter.com/swilliams/status/658802940866465792">October 27, 2015</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>Yeah, any diet that was courting me was gonna need a really good pre-nup before I&rsquo;d commit to it.</p>

<p>I also had developed quite a fondness for soda. That became my caffeine delivery system of choice. Some people would come into the office with their Starbucks cup, I had my thirstbuster. At some point I switched over to diet soda, which is gross, but had less calories. I never really dug into the science of it, but I don&rsquo;t know if that&rsquo;s an even tradeoff, especially at 48oz (or more, yikes) per day. I eventually decided to ween myself off soda and force myself to like coffee (and it&rsquo;s miniscule calorie content) instead. It took some doing, but I now appreciate the stuff. Being able to do the ceremony of <a href="http://www.amazon.com/Aeropress-Coffee-and-Espresso-Maker/dp/B0047BIWSK?sr=1-1&amp;qid=1465330919&amp;keywords=aeropress&amp;ref_=sr_1_1&amp;tag=thepetzoo-20&amp;ie=UTF8&amp;s=kitchen">Aeropressing</a> everything helped trick my brain into thinking it was doing something fancy too.</p>

<p>Despite curtailing soda significantly, I still usually had at least one 12oz can of Coke with lunch, nearly every day. I really wanted to kick it altogether, but the flesh is weak. Through sheer willpower I got it down to one (or two) per week. That maintained for a couple of months, and then I got the stomach flu and was waylaid for a few days. Due to a coincidence of timing, I managed to go a whole seven days without any soda, hitting that one week goal. After that, it was easier to skip. That&rsquo;s a rather &ldquo;unorthodox&rdquo; approach, but I guess it worked? I&rsquo;ll have a soda every now and then<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>, but it doesn&rsquo;t have the same allure as it used to.</p>

<p>Snacking has been harder to cut back on. Free food at the office seems to be able to circumvent most of the circuits in my brain and hit the MUST-HAVE centers directly. After a really long fight I&rsquo;ve cut back on trips to the candy dish full of delicious Hershey nuggets to a minimum.</p>

<p>And let&rsquo;s talk about diet in general. Like I said, I&rsquo;m never going to be be successful on one found in a magazine, but I could make changes to my diet in general. I&rsquo;m not going to ever cut carbs out completely, but I don&rsquo;t have bagels nearly as much as I used to. Now they&rsquo;re more of a special occasion than a common occurrence.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I refuse to do business with anyone that doesn’t acknowledge the glory of the jalapeño bagel.</p>&mdash; Scott Williams (@swilliams) <a href="https://twitter.com/swilliams/status/723587932720783360">April 22, 2016</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>Time permitting, I cook up some breakfast sausage and eggs in the morning. If I&rsquo;m feeling like I really want to be healthy (which is rare), I&rsquo;ll get some greek yogurt, granola, and fruit, but frankly I&rsquo;m not much of a fan of that.</p>

<p>I try to track the calories too. I use <a href="https://www.myfitnesspal.com/">MyFitnessPal</a>, but I I&rsquo;m not exactly in love with it. Their database is probably the best out there, but it&rsquo;s not complete; and as a software developer I empathize with the notion of tracking <em>every single food item in the world</em>, but it&rsquo;s still too annoying to try to find everything, especially if you cook a lot of your meals or don&rsquo;t eat at chain restaurants. I probably only track about 50% of the stuff I eat, and sometimes go for days without tracking anything (which I&rsquo;m betting maps up quite well with the times I eat worse).</p>

<p>My meals themselves aren&rsquo;t <strong>too</strong> bad. My wife and I both like to cook, so we have a home cooked meal most days, and don&rsquo;t go the Full Paula Deen. My achilles heel at home is snacks. I love chips, crackers, cookies, pretzels, anything crunchy really. If given the choice between some chocolate and cheez-its, I&rsquo;ll side with Team Kellogg. I can&rsquo;t mandate that those things are forbidden in our house either. My wife and kids have better self-discipline. Rather, I&rsquo;m trying to look at trends when I snack down too much. I usually snack in the evenings. The snacks are downstairs, and I&rsquo;ll usually spend the evenings upstairs. With these two data points, I try to avoid going downstairs in the evenings; laziness beats out food, usually.</p>

<p>I also regress more often than I care to admit. I&rsquo;ll have a few good days, and then eat too many chips or cookies. It&rsquo;s getting better, but fortunately the other prong in my plan helps offset some of that.</p>

<h2>Exercise a little more</h2>

<p>Filling in the rings on the Apple Watch is fun. Getting a chain is of completions is even better, and creates a virtuous cycle. I wanted to keep hitting my goal and increasing the streak of completions. I got my watch right before traveling to San Fransisco for <a href="https://developer.apple.com/wwdc/">WWDC</a>, a conference for Apple-centric software developers. It was a full week out there, and involved a lot of walking. I hit 2.5-3x my move goal every day out there. I was hooked on keeping that thing filled out.</p>

<p>Since the gym wasn&rsquo;t going to work for me, I tried to think about what I could do that would be sustainable for my lazy self. Walking was the obvious choice, but I also wanted to move just a little beyond that. I didn&rsquo;t want to take up running [yet]; I had tried doing that before and burnt out on it quicker than weight training. Also it was summer in Phoenix which meant if you were outside you ran the risk of facing the wrath of an angry God.</p>

<iframe width="420" height="315" src="https://www.youtube.com/embed/4PYt0SDnrBE" frameborder="0" allowfullscreen></iframe>


<p>Smaller steps were needed. I started to take a lap around the office atrium a few times a day. I&rsquo;d walk for 8 minutes to a nearby shop for lunch rather than drive for 2. I even ended up running in place at home (in the air conditioning). Yes, that&rsquo;s as dorky as it sounds, and I would stop if another human came within visual range because it&rsquo;s just so embarrassing. But it worked well enough, and I could do it just a few minutes here and there to fill out the rings.</p>

<p>Eventually, I figured that I should try to suck it up and run again. So, in late July (yes, when your shoes might stick to the pavement because they&rsquo;re melting) I &ldquo;ran&rdquo; a 5k. My time was 40:49 and involved a lot of walking, but I completed it, and drank a gallon of water afterward.</p>

<p>After that, and the heat, I didn&rsquo;t do another run until mid September, and then again until early October. I remember not wanting to run — I felt incredibly sore, sweaty, and would much rather continue doing the little stuff that I had been for the first few months. But by this time, I wanted to &ldquo;level-up&rdquo; a bit. The competitive side of me started to kick in and I wanted to see if I could be a &ldquo;runner&rdquo;.</p>

<p>My first goal was to complete a 5k without taking a walking break, which I had never done before. As I got a little better, my time dropped down to the mid 30&rsquo;s. Then I managed to run it with taking a single walking break for just one minute. Finally in mid November I ran 3.11 miles straight without any breaks. Shortly after that I cracked another goal and ran it in under 30 minutes<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>. I wasn&rsquo;t expecting to do that quite so quickly.</p>

<p>This wasn&rsquo;t without any hitches though. I had some nasty shin splints at the start. I would be incredibly sore from a run and hit the Advil right after the shower. And the chafing, oh the chafing <em>[picture removed, gross, come on. &mdash;ed]</em>. Taking it a little easier helped the shin splints to go away, and eventually the soreness stopped being an issue.</p>

<p>Something weird happened. I started to enjoy running. The sense of satisfaction from completing a run grew. I started to go a little longer, occasionally a little faster. I got to the end of my first 5 mile run and thought, &ldquo;hey, I bet I could go a little further&rdquo;. I forced myself to not overdo it and not add too much distance too quickly.</p>

<p>I also started to consider races. I am under no illusion that I would be competitive in any kind of race<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup>, but actually putting something on an official record sounded interesting. I could run a 10k well enough, and thought about one of the longer races for a stretch goal. A full marathon was probably out of the question due to time constraints, but the half was alluring. You train for something like that by doing <a href="http://www.halfmarathons.net/half-marathon-training-schedule-for-beginning-runners/">moderately short runs during the week and a longer one on weekends.</a> You don&rsquo;t even have to run the 13.1 miles during training. I figured why not? and signed up for the <a href="http://www.runrocknroll.com/arizona/">Rock-n-Roll</a> half marathon in January 2017.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Well that happened. <a href="https://t.co/fKqyxKl6cx">pic.twitter.com/fKqyxKl6cx</a></p>&mdash; Scott Williams (@swilliams) <a href="https://twitter.com/swilliams/status/730413542755590145">May 11, 2016</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>This process took a whole year. And it was a gradual, incredibly gradual, increase in effort. If 2015 me had flipped a switch and started running right away as often as I do now, he would have given up pretty quickly.</p>

<p>The other big question: is this sustainable? It&rsquo;s been a year, and if anything, my dedication to getting healthier is stronger than it was before. I weigh 194 pounds now, and want to get to 175. The road has been uneven, but the trajectory is going in the right direction.</p>

<h2>Misc</h2>

<ul>
<li>Calorie counting is such a pain in the butt, and I don&rsquo;t necessarily believe what any of my trackers tell me&hellip; After putting my age/weight/goal into MyFitnessPal it told me that if I ate 2600 calories per day I&rsquo;d lose a pound a week. That&rsquo;s a flat out lie. If I want to lose weight, I need to keep it under 2000 and keep up my exercise routine.</li>
<li>Relatedly, that thing where <a href="http://www.nytimes.com/2016/05/02/health/biggest-loser-weight-loss.html?_r=0">if you lose a bunch of weight and then your body fights against you to gain it back</a>? I think I&rsquo;m seeing that to a small extent. My hope is that since I don&rsquo;t plan to stop my routine, it won&rsquo;t come flooding back, and that it&rsquo;ll settle down after a while.</li>
<li>I still drink alcohol too. I don&rsquo;t drink much beer anymore, preferring wine and whiskey.</li>
<li>My fastest 5k is 26:56, and I almost always keep them under 30 minutes. I don&rsquo;t think I&rsquo;ll be breaking that again until it cools off&hellip; in November.</li>
<li>I used to run at night, but switched to mornings. My body would be tired after a run, but my brain would be rocking out like Andrew WK, causing me sleep difficulty.</li>
<li>My calorie burn rate has dropped significantly. I think this is a good thing. The jog in place thing used to get up to 12 per minute, but that&rsquo;s down to 9 now. Yes, I still do it if I&rsquo;m close to my daily goal and don&rsquo;t want to go back outside. Stop judging me.</li>
<li>If you&rsquo;re on RunKeeper, look me up!</li>
</ul>


<div class="footnotes">
  <ol>
  <li class="footnote" id="fn:1">
  <p>Seriously, I&#8217;m not too proud to eat from a gas station if necessary. I find Olive Garden and Chili&#8217;s to be gross though.</p>
</li>
<li class="footnote" id="fn:2">
  <p>I don&#8217;t have the exact number because I was too embarrassed to weigh myself before starting on my latest track. I regret this decision because now I don&#8217;t know exactly how much weight I lost. My first measurement was at 239 after about a month and a half, so with a little guess work I figure it was around 245.</p>
</li>
    <li class="footnote" id="fn:3">
  <p>This is why I don&#8217;t really understand <a href="https://www.soylent.com/">Soylent</a> and the things like it. I don&#8217;t eat to get full, I eat because food is great. This is probably also why I&#8217;m fat.</p>
</li>
<li class="footnote" id="fn:4">
  <p>I think I&#8217;ve had under 5 for all of 2016 so far.</p>
</li>
<li class="footnote" id="fn:5">
  <p>29:56 on November 23.</p>
</li>
<li class="footnote" id="fn:6">
  <p>Hearing a teenaged runner talk about getting his 5k under 20 minutes was an eye-opener. I am optimistic about improving my speed, but I don&#8217;t think I&#8217;ll ever get that fast.</p>
</li>
  </ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/05/15/introducing-gliphy/" itemprop="url">Introducing Gliphy</a></h1>
    <div class="date">








  


<time datetime="2016-05-15T13:47:59-07:00" data-updated="true" itemprop="datePublished">May 15<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>I&rsquo;m very happy to introduce a new open source library that I&rsquo;ve been building. It&rsquo;s called <a href="https://github.com/tallwave/gliphy">Gliphy</a> and it makes implementing <a href="https://developer.apple.com/library/ios/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/CustomTextProcessing/CustomTextProcessing.html#//apple_ref/doc/uid/TP40009542-CH4-SW65">Dynamic Type</a> on iOS with Swift a breeze.</p>

<p>Accessibility is one of those things that everyone knows they should be better at implementing, but falls to the wayside when deadlines are looming. I liked the idea of supporting Dynamic Type in the apps I write, but it was kind of a slog to implement it. There are two main ways to do it right out of the gate with what is built in to iOS, code and Interface Builder.</p>

<p>Let&rsquo;s go with code first. The easiest way to get the preferred font for a given text style.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">titleLabel</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="bp">UIFont</span><span class="p">.</span><span class="n">preferredFontForTextStyle</span><span class="p">(</span><span class="n">UIFontTextStyleHeadline</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>iOS will set whatever the &ldquo;Headline&rdquo; style is to your <code>titleLabel</code>&rsquo;s font. If a user changes their default font size in Settings, it&rsquo;ll scale with that.</p>

<p>Interface Builder makes it fairly simple too:</p>

<figure>
    <img alt="Interface Builder" src="https://raw.githubusercontent.com/Tallwave/Gliphy/gh-pages/images/ib.png">
    <figcaption>Choose a style from the font menu in Interface Builder</figcaption>
</figure>


<p>But there&rsquo;s a catch. If a user launches your app, then changes the font size, your app won&rsquo;t display any new changes until it has quit and is relaunched. You can watch for the <code>UIContentSizeCategoryDidChangeNotification</code> notification though and then re-render your text based views then<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. So, regardless of your choice you&rsquo;ll have to code out <em>a lot</em> of labels, buttons, and text fields. In a normal app, that&rsquo;s hundreds of lines of boring code.</p>

<p>The other big downside is that you&rsquo;re limited to the system font. So, San Francisco on iOS 9 and Helvetica Neue on older versions. I like those fonts just fine, but sometimes you need to switch it up.</p>

<h2>BNRDynamicTextManager</h2>

<p>I first came across <a href="https://www.bignerdranch.com/">Big Nerd Ranch&rsquo;s</a> <a href="https://github.com/bignerdranch/BNRDynamicTypeManager">BNRDynamicTextManager</a> library and found it to be pretty useful. You still have to wire up each field (or use subclasses), and you&rsquo;re still stuck with the system font, but it handled all the notification watching for you. Here&rsquo;s a sample:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">BNRDynamicTypeManager</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">watchLabel</span><span class="p">:</span><span class="n">label</span>
</span><span class='line'>                                         <span class="nl">textStyle</span><span class="p">:</span><span class="n">UIFontTextStyleBody</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>The library was lightweight and easy to understand<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>, which got me thinking.</p>

<h2>Gliphy</h2>

<p>I decided to port BNRDynamicTextManager to Swift and see if I could add some functionality to it. Porting it wasn&rsquo;t a big deal, although I made a couple of changes to better match Swift&rsquo;s idioms. I then added a couple of nice features on top.</p>

<p><strong>Big Feature 1 — Custom Fonts</strong><br />
Watcher methods can take the name of a custom font:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">DynamicTypeManager</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">watchLabel</span><span class="p">(</span><span class="n">titleLabel</span><span class="p">,</span>
</span><span class='line'>                                             <span class="nl">textStyle</span><span class="p">:</span> <span class="n">UIFontTextStyleTitle1</span><span class="p">,</span>
</span><span class='line'>                                             <span class="nl">fontName</span><span class="p">:</span> <span class="s">&quot;MarkerFelt-Thin&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will apply the font size of the &ldquo;Headline&rdquo; style to your label, but keep the glorious MarkerFelt font. If the <code>fontName</code> is not associated with an installed font, it will fall back to the system font.</p>

<p><strong>Big Feature 2 — Custom Styles</strong><br />
iOS 7 brought us six text styles, and iOS 9 brought four more<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>. They cover a decent range of use cases, but sometimes you still want your own. You can do that with the <code>DynamicFontRegistry</code> class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// This could be in AppDelegate, some custom Theme class, or wherever</span>
</span><span class='line'><span class="n">DynamicFontRegistry</span><span class="p">.</span><span class="n">registry</span><span class="p">.</span><span class="n">addTextStyle</span><span class="p">(</span><span class="s">&quot;UIFontTextStyleReallyReallyBigTitle&quot;</span><span class="p">,</span>
</span><span class='line'>                                          <span class="nl">scaledFrom</span><span class="p">:</span> <span class="n">UIFontTextStyleHeadline</span><span class="p">,</span>
</span><span class='line'>                                          <span class="nl">byFactor</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to keep with the feel of how Dynamic Type works, you pick a style to serve as a base reference for the new one and then scale it from there. That way you don&rsquo;t hardcode a point size. You can then watch it the same way you would before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">DynamicTypeManager</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">watchLabel</span><span class="p">(</span><span class="n">titleLabel</span><span class="p">,</span>
</span><span class='line'>                                             <span class="nl">textStyle</span><span class="p">:</span> <span class="s">&quot;UIFontTextStyleReallyReallyBigTitle&quot;&quot;, </span>
</span><span class='line'>                                             <span class="nl">fontName</span><span class="p">:</span> <span class="s">&quot;MarkerFelt-Thin&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Big Feature 3 — Global Styles</strong><br />
I liked how it was working now, but it was still a long process to cover all the text based views that could be in an app. I wanted a solution that would make it super easy to handle the 90% scenario. Enter the <code>StyleWatcher</code> and <code>StyleConfig</code> constructs. The <code>StyleWatcher</code> will recursively examine each subview in a parent view and watch them with the <code>DynamicTypeManager</code> if they have a text style associated with them. That way you can set up the text-styles solely UI within Interface Builder and remove an entire swath of code. Additionally, you can set a global style that the watcher will use to find your custom font (or style).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// AppDelegate</span>
</span><span class='line'><span class="c1">// Setting up the global styles</span>
</span><span class='line'><span class="n">StyleWatcher</span><span class="p">.</span><span class="n">defaultConfig</span><span class="p">.</span><span class="n">label</span><span class="p">[</span><span class="n">UIFontTextStyleTitle1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;MarkerFelt-Thin&quot;</span>
</span><span class='line'><span class="n">StyleWatcher</span><span class="p">.</span><span class="n">defaultConfig</span><span class="p">.</span><span class="n">label</span><span class="p">[</span><span class="n">UIFontTextStyleTitle1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;MarkerFelt-Thin&quot;</span>
</span><span class='line'><span class="n">StyleWatcher</span><span class="p">.</span><span class="n">defaultConfig</span><span class="p">.</span><span class="n">textField</span><span class="p">[</span><span class="n">UIFontTextStyleBody</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Avenir-Light&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once that has been set up, tell the watcher to watch a view:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// In some View Controller</span>
</span><span class='line'><span class="k">let</span> <span class="n">watcher</span> <span class="o">=</span> <span class="n">StyleWatcher</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>    <span class="n">watcher</span><span class="p">.</span><span class="n">watchViews</span><span class="p">(</span><span class="nl">inView</span><span class="p">:</span> <span class="n">view</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the magic will happen.</p>

<p>You can customize that process too. The <code>watchViews</code> method can take its own <code>StyleConfig</code> as well, allowing you to define multiple different styles and applying them where necessary.</p>

<p>I&rsquo;m pretty happy with the way Gliphy turned out. The <a href="https://github.com/tallwave/gliphy">code</a> is pretty straightforward too; no mind bending swiftisms required. There are some downsides though. Attributed strings aren&rsquo;t handled at all, and due to their nature, they probably will never be. Gliphy only watches four kinds of views: labels, buttons, textfields, and textviews, (plus their subclasses) and is a little difficult to extend beyond that.</p>

<p>All said though, it should make supporting Dynamic Type something more than an afterthought in your apps.</p>

<div class="footnotes">
  <ol>
    <li class="footnote" id="fn:1">
  <p>There is a bug in the iOS simulator and Xcode 7.3. You can change the font size, but the notification will not fire. It still works on a device though.</p>
</li>
<li class="footnote" id="fn:2">
  <p>I raise my glass to <a href="https://github.com/jgallagher">jgallagher</a> for that.</p>
</li>
<li class="footnote" id="fn:3">
  <p>Here they are:
  <ul>
    <li>UIFontTextStyleHeadline</li>
    <li>UIFontTextStyleSubheadline</li>
    <li>UIFontTextStyleBody</li>
    <li>UIFontTextStyleFootnote</li>
    <li>UIFontTextStyleCaption1</li>
    <li>UIFontTextStyleCaption2</li>
    <li>UIFontTextStyleTitle1</li>
    <li>UIFontTextStyleTitle2</li>
    <li>UIFontTextStyleTitle3</li>
    <li>UIFontTextStyleCallout</li>        
  </ul>
  </p>
</li>
  </ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2016/05/05/combining-if-let-and-where-in-swift/" itemprop="url">Combining if Let and Where in Swift</a></h1>
    <div class="date">








  


<time datetime="2016-05-05T10:55:32-07:00" data-updated="true" itemprop="datePublished">May 5<span>th</span>, 2016</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>What I like about Swift is that it feels like a natural progression when learning more of the language&rsquo;s features. Case in point: I&rsquo;ve known about the <code>where</code> keyword for a while, and have used it plenty of times before, but just found this little ditty:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">someBool</span> <span class="o">=</span> <span class="n">someThing</span><span class="o">?</span><span class="p">.</span><span class="n">someBool</span> <span class="k">where</span> <span class="n">someBool</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// do stuff if someBool is true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That will only execute the body of the statement if <code>someThing</code> is not nil and <code>someBool</code> is true. Before, I had thought that would&rsquo;ve been two separate statements, and extra indenting. Kinda cool.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2015/12/11/private-extensions-in-swift/" itemprop="url">Private Extensions in Swift</a></h1>
    <div class="date">








  


<time datetime="2015-12-11T11:08:59-07:00" data-updated="true" itemprop="datePublished">Dec 11<span>th</span>, 2015</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>Here&rsquo;s a quickie. In Swift, the default <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/AccessControl.html">accessor</a> for strcutures is <code>internal</code>, meaning that it is available to everything else within the module. You can change this by adding <code>private</code> or <code>public</code> in front of them like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">private</span> <span class="k">class</span> <span class="n">Foo</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>private</code> means that the construct is only available within the same file. I just &ldquo;discovered&rdquo;<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> that you can also mark an <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Extensions.html">Extension</a> as <code>private</code>, which I hadn&rsquo;t considered before. This let&rsquo;s you add functionality to a struct or class that may be useful in the current context of everything within that same file, but doesn&rsquo;t make sense elsewhere.</p>

<p>For example, in a <a href="https://developer.apple.com/healthkit/">HealthKit</a> project you may be only dealing with fluid ounces for an <code>HKQuantitySample</code> and converting all the time is a bit of a pain. You don&rsquo;t necessarily want to make a <code>quantityInOunces</code> computed variable  available on the whole app, but in a specific file where you&rsquo;re computed all those ounces, it makes sense.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">private</span> <span class="k">extension</span> <span class="n">HKQuantitySample</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">var</span> <span class="nl">quantityInOunces</span><span class="p">:</span> <span class="n">Double</span><span class="o">?</span> <span class="p">{</span> <span class="cm">/* blah */</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="n">HealthKitManager</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">doStuff</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Calculate a bunch of ounces easy peasy.</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<div class="footnotes">
  <ol>
    <li class="footnote" id="fn:1">
  <p>Couldn&#8217;t think of a better word, but yeah I&#8217;m regular Vasco de Gama.</p>
</li>
  </ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2015/11/05/the-good-the-bad-and-the-ugly-with-the-apple-tv/" itemprop="url">The Good, the Bad, and the Ugly With the Apple TV</a></h1>
    <div class="date">








  


<time datetime="2015-11-05T08:28:09-07:00" data-updated="true" itemprop="datePublished">Nov 5<span>th</span>, 2015</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>A new Apple device! I&rsquo;m required to have opinions. Here they are in a contrived fashion!</p>

<h1>The Good</h1>

<p>Great UI and aesthetics.</p>

<p>It&rsquo;s faster.</p>

<p>Scrubbing through video is significantly improved. I almost don&rsquo;t believe how much better it is.</p>

<p>Siri works as advertised. Accuracy, speed, and results are all great.</p>

<p>All the potential!</p>

<h1>The Bad</h1>

<p>Siri doesn&rsquo;t index content stored in iTunes libraries on the network. So to get to all the DVDs and Blu-rays I&rsquo;ve ripped I have to use the same UI as the old Apple TV.<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>

<p>Siri doesn&rsquo;t work with Music. Not for music libraries on the network, iTunes Match, or Apple Music. I really don&rsquo;t understand this one, I&rsquo;m hoping it comes soon.</p>

<p>Only one remote can be paired with it. This makes gaming tricky. Hoping this changes soon too.</p>

<h1>The Ugly</h1>

<p>Passwords. This has already been discussed at length everywhere. One thought I had would be that it&rsquo;d be cool to enter passwords via Siri. Y&#8217;know, like that one scene in TNG:</p>

<iframe width="420" height="315" src="https://www.youtube.com/embed/oNrWgjh9tnU" frameborder="0" allowfullscreen></iframe>


<p>(A Touch ID powered remote would probably be better)</p>

<p>App discoverability. It&rsquo;s really bad, and I don&rsquo;t know how they&rsquo;re going to fix it. Top Charts was just added, which is better than nothing, but if someone wants to market their app anywhere online they have no way to provide a link to it! &ldquo;Go to the app store, search for s-o-m-e-t-h-i&hellip;&rdquo; is all kinds of awful.</p>

<p>Overall I like it. I have almost no reason to use the Roku now<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<div class="footnotes">
  <ol>
    <li class="footnote" id="fn:1">
  <p>I do not have Plex, so I don&#8217;t know if that circumvents it. If it does, I may grab it asap.</p>
</li>
<li class="footnote" id="fn:2">
  <p>Other than the rare times there&#8217;s something on Amazon Video that isn&#8217;t anywhere else.</p>
</li>
  </ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		
	</div>
	<h1 class="title" itemprop="name"><a href="/words/2015/08/09/finding-the-last-photo-taken/" itemprop="url">Finding the Last Photo Taken</a></h1>
    <div class="date">








  


<time datetime="2015-08-09T19:40:43-07:00" data-updated="true" itemprop="datePublished">Aug 9<span>th</span>, 2015</time></div>
	<div class="entry-content" itemprop="articleBody">
		<p>Getting the last photo taken is a convenient feature to have in your app when dealing with photo picking. Prior to iOS 8, you could get it by using the <a href="https://developer.apple.com/library/ios/documentation/AssetsLibrary/Reference/AssetsLibraryFramework/index.html#//apple_ref/doc/uid/TP40009730">Assets Library Framework</a> and then <a href="http://stackoverflow.com/a/10200857/736">looping through the various groups</a> to get the right photo.</p>

<p>In iOS 8, the Asset Library is still available, but Apple introduced a new framework to go along with <a href="http://www.apple.com/osx/photos/">Photos.app</a>. It&rsquo;s creatively called the <a href="https://developer.apple.com/library/ios/documentation/Photos/Reference/Photos_Framework/index.html#//apple_ref/doc/uid/TP40014408">Photos Framework</a> and it makes certain things, such as querying for the recent image much easier. To further entice you to use it, the Assets Library is deprecated in iOS 9.</p>

<p>Here&rsquo;s a function that&rsquo;ll get the most recent photo with the Photos Framework:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">import</span> <span class="n">UIKit</span>
</span><span class='line'><span class="k">import</span> <span class="n">Photos</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// I like to typealias my blocks, makes for easier reading</span>
</span><span class='line'><span class="k">typealias</span> <span class="n">ImageCallback</span> <span class="o">=</span> <span class="p">(</span><span class="bp">UIImage</span><span class="o">?</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="n">fetchLastPhoto</span><span class="p">(</span><span class="n">resizeTo</span> <span class="nl">size</span><span class="p">:</span> <span class="bp">CGSize</span><span class="o">?</span><span class="p">,</span> <span class="nl">imageCallback</span><span class="p">:</span> <span class="n">ImageCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">fetchOptions</span> <span class="o">=</span> <span class="n">PHFetchOptions</span><span class="p">()</span>
</span><span class='line'>    <span class="n">fetchOptions</span><span class="p">.</span><span class="n">sortDescriptors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSSortDescriptor</span><span class="p">(</span><span class="nl">key</span><span class="p">:</span> <span class="s">&quot;creationDate&quot;</span><span class="p">,</span> <span class="nl">ascending</span><span class="p">:</span> <span class="nb">false</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//        fetchOptions.fetchLimit = 1 // Available in iOS 9</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="k">let</span> <span class="n">fetchResult</span> <span class="o">=</span> <span class="n">PHAsset</span><span class="p">.</span><span class="n">fetchAssetsWithMediaType</span><span class="p">(.</span><span class="n">Image</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="n">fetchOptions</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="k">let</span> <span class="n">asset</span> <span class="o">=</span> <span class="n">fetchResult</span><span class="p">.</span><span class="n">firstObject</span> <span class="kt">as</span><span class="o">?</span> <span class="n">PHAsset</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">PHImageManager</span><span class="p">.</span><span class="n">defaultManager</span><span class="p">()</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">targetSize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">nil</span> <span class="o">?</span> <span class="bp">CGSize</span><span class="p">(</span><span class="nl">width</span><span class="p">:</span> <span class="n">asset</span><span class="p">.</span><span class="n">pixelWidth</span><span class="p">,</span> <span class="nl">height</span><span class="p">:</span> <span class="n">asset</span><span class="p">.</span><span class="n">pixelHeight</span><span class="p">)</span> <span class="o">:</span> <span class="n">size</span><span class="o">!</span>
</span><span class='line'>            <span class="n">manager</span><span class="p">.</span><span class="n">requestImageForAsset</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span>
</span><span class='line'>                <span class="nl">targetSize</span><span class="p">:</span> <span class="n">targetSize</span><span class="p">,</span>
</span><span class='line'>                <span class="nl">contentMode</span><span class="p">:</span> <span class="p">.</span><span class="n">AspectFit</span><span class="p">,</span>
</span><span class='line'>                <span class="nl">options</span><span class="p">:</span> <span class="nb">nil</span><span class="p">,</span>
</span><span class='line'>                <span class="nl">resultHandler</span><span class="p">:</span> <span class="p">{</span> <span class="n">image</span><span class="p">,</span> <span class="n">info</span> <span class="k">in</span>
</span><span class='line'>                <span class="n">imageCallback</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">imageCallback</span><span class="p">(</span><span class="nb">nil</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s a fair amount going on in there. First, we create a <a href="https://developer.apple.com/library/prerelease/ios/documentation/Photos/Reference/PHFetchOptions_Class/index.html#//apple_ref/occ/cl/PHFetchOptions"><code>PHFetchOptions</code></a> object which we can use to pass in additional information to filter the query. In this case we only need to sort by <code>creationDate</code> descending. iOS 9 introduces <code>fetchLimit</code> which could reduce a bit of overhead since we know we only need 1 image.</p>

<p><code>PHFetchOptions</code> also has a <code>predicate</code> property that has a bunch of interesting capabilities, such as restricting the search to specific <code>mediaSubtypes</code> like <code>PhotoHDR</code> or <code>PhotoPanorama</code>. If you want all photos just ignore it; that&rsquo;s determined later. Do note that <em>&ldquo;Photos does not support predicates created with the <code>predicateWithBlock:</code> method.&rdquo;</em>.</p>

<p>Once we have our options we are ready to query. The Photos Framework gives you access to 3 types of things that are stored in Photos.app: <code>PHAsset</code>, <code>PHAssetCollection</code>, and <code>PHCollectionList</code>. We only care about <a href="https://developer.apple.com/library/prerelease/ios/documentation/Photos/Reference/PHAsset_Class/index.html#//apple_ref/occ/cl/PHAsset"><code>PHAsset</code></a> right now. A <code>PHAsset</code> is a representation of the media stored on the device (photo or video). The other two are ways to group those assets in general.</p>

<p>Querying happens through class-level methods on the <code>PHAsset</code> class. There are <a href="https://developer.apple.com/library/prerelease/ios/documentation/Photos/Reference/PHAsset_Class/index.html#//apple_ref/doc/uid/TP40014383-CH1-SW2">a few to choose from</a>, but we want <code>fetchAssetsWithMediaType:options:</code>. This returns a <a href="https://developer.apple.com/library/prerelease/ios/documentation/Photos/Reference/PHFetchResult_Class/index.html#//apple_ref/occ/cl/PHFetchResult"><code>PHFetchResult</code></a> which is kinda like an <code>NSArray</code>, but not exactly. In Swift it&rsquo;s filled with optional <code>AnyObject</code>s. The first one should be the most recently created file so we cast it to a <code>PHAsset</code>.</p>

<p>Now comes the time to convert that <code>PHAsset</code> into what we really want: a <code>UIImage</code>. This is the responsibility of <a href="https://developer.apple.com/library/prerelease/ios/documentation/Photos/Reference/PHImageManager_Class/index.html#//apple_ref/occ/cl/PHImageManager"><code>PHImageManager</code></a>.</p>

<p>Most of the time when querying for images, we just want to resize the photo to fit into a <code>UIImageView</code> so Photos does most of the heavy lifting for you. Give it the size you want and a couple other options and off it will go. This happens asynchronously, so hand off the results to your callback block when it&rsquo;s done. This&rsquo;d be especially handy for generating a bunch of thumbnails.</p>

<p>Photos gives you quite a bit of flexability. We didn&rsquo;t touch on how it helps you to edit assets, manage/query video, or observe changes to photos. I wasn&rsquo;t aware of this framework until today, but it looks like a powerful one worth getting to know if you do anything with the images on your device.</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/words/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2017 - Scott Williams -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
			



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
