---
layout: post
title: "Customizing the Link Color in a UITextView"
date: 2013-08-07 23:22:19
comments: false
author: Scott Williams
categories: []
---
<p><a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/uitextview_class/Reference/UITextView.html">UITextView's</a> can automatically detect URLs and treat them accordingly. This is a <em>nice</em> feature, but when you start to customize your UI, you might run into the situation on the right. That contrast between the background and foreground colors makes it pretty hard to read. A quick poke through the docs and on <a href="http://stackoverflow.com/questions/1350423/can-i-change-the-color-of-auto-detected-links-on-uitextview">StackOverflow</a> reveals that there isn't any way to change the color of the link, without resorting to <a href="http://stackoverflow.com/a/17294355/736">private API's</a>.</p><img src="/images/assets/bad%20popover.png" /><p>Sooo, the best course of action is to just knuckle down and use a UIWebView to display what you want.</p>

<p>To try to keep things relatively sane, I first added a static <code>html</code> file to my project with this content:</p><pre class="source-code"><span class="cm-tag">&lt;html</span><span class="cm-tag">&gt;</span><br>  <span class="cm-tag">&lt;head</span><span class="cm-tag">&gt;</span><br>    <span class="cm-tag">&lt;title</span><span class="cm-tag">&gt;</span><span class="cm-tag">&lt;/title</span><span class="cm-tag">&gt;</span><br>    <span class="cm-tag">&lt;style</span><span class="cm-tag">&gt;</span><br>       <span class="cm-tag">html</span>, <span class="cm-tag">body</span>, <span class="cm-tag">div</span> {<br>         <span class="cm-property">background</span><span class="cm-operator">:</span> <span class="cm-atom">#3D3D3D</span>;<br>         <span class="cm-property">font-family</span><span class="cm-operator">:</span> <span class="cm-variable-2">HelveticaNeue-Medium</span>, <span class="cm-variable-2">Helvetica</span>;<br>         <span class="cm-property">font-size</span><span class="cm-operator">:</span> <span class="cm-number">12pt</span>;<br>         <span class="cm-property">color</span><span class="cm-operator">:</span> <span class="cm-atom">#FAFAF1</span>;<br>       }<br>      <br>       <span class="cm-tag">a</span> {<br>         <span class="cm-property">color</span><span class="cm-operator">:</span> <span class="cm-atom">#FAFAF1</span>;<br>       }<br>    <span class="cm-tag">&lt;/style</span><span class="cm-tag">&gt;</span><br>  <span class="cm-tag">&lt;/head</span><span class="cm-tag">&gt;</span><br>  <span class="cm-tag">&lt;body</span><span class="cm-tag">&gt;</span><br>     REPLACEME<br>  <span class="cm-tag">&lt;/body</span><span class="cm-tag">&gt;</span><br><span class="cm-tag">&lt;/html</span><span class="cm-tag">&gt;</span></pre><p>The CSS code is inlined in the file. There's probably a way to keep it separate and inject it, but I didn't need anything fancier than this.</p>

<p>Loading it was pretty straightforward:</p><pre class="source-code">+ (NSString *)htmlTemplate {<br>  NSString *path = [[NSBundle mainBundle] pathForResource:@"html-template" ofType:@"html"];<br>  return [NSString stringWithContentsOfFile:path encoding:NSUTF8StringEncoding error:nil];<br>}   <br></pre><p>Then on my controller I called this method from <code>viewDidLoad</code>:</p><pre class="source-code">- (void)setContentText:(NSString *)contentText {<br>  NSString *template = [MyTemplateManager htmlTemplate];<br>  NSString *htmlText = [template stringByReplacingOccurrencesOfString:@"REPLACEME" withString:contentText];<br>  [contentView loadHTMLString:htmlText baseURL:nil];<br>}   <br></pre><p><code>contentView</code> is the <code>UIWebView</code>. Almost done. If you tap on a link in the webview it'll open that link in itself, which might not be what you want. The way around it is to set your controller to be a <code>UIWebViewDelegate</code> and implement <a href="http://stackoverflow.com/a/2899793/736">this method</a>:</p><pre class="source-code">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType {<br>  if (navigationType == UIWebViewNavigationTypeLinkClicked) {<br>    [[UIApplication sharedApplication] openURL:[request URL]];<br>    return NO;<br>  }<br>  return YES;<br>}</pre><p>That'll open it in Safari. If you want other browsers, well, knock yourself out. This is pretty much a giant mess for something that should be easy, but it's just something that would have to be done if you want total control over the UI. The end result looks well enough:</p><img src="/images/assets/good%20popover.png" />